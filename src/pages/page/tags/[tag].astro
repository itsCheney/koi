---
import { getCollection } from 'astro:content';
import BlogPostList from '../../../layouts/BlogPostList.astro';
import { filterPosts } from '../../../utils/misc';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const tags = [...new Set(posts.flatMap(post => post.data.tags).filter(tag => tag))];
  return tags.map(tag => ({ params: { tag } }));
}

const { tag } = Astro.params;
const allPosts = await getCollection('blog');
const filtered = allPosts.filter(post => post.data.tags?.includes(tag!));
const posts = filterPosts(filtered, { filterDraft: true, filterUnlisted: true });
---

<BlogPostList data={posts} currentPage={1} lastPage={1} title={`分类: ${tag}`} description={`关于“${tag}”的全部文章`} />
